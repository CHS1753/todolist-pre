<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="board.css" rel="stylesheet">
  <script src="board.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
     const indexOfEqual = location.search.indexOf("=");
    const bno = +(location.search.substring(indexOfEqual+1))
    const boards = getBoards();
    const board = getBoard(boards, bno);
    // console.log(boards);
    // console.log(board);
    // console.log(bno);
    if(board===null) {
      location.href="index-1.html";
    }
  </script>
</head>

<body>
  <div id="app">
    <h1>글 읽기</h1>
    <table class="table">
      <tr>
        <td>글번호</td>
        <td><input type="text" id="bno" readonly class="form-control"></td>
      </tr>
      <tr>
        <td>제목</td>
        <td><input type="text" id="title"  class="form-control"></td>
      </tr>
        <td>비밀번호</td>
        <td><input type="password" id="password"  class="form-control"></td>
      </tr>
        <td>작성자</td>
        <td><input type="text" id="nickname" readonly class="form-control"></td>
      </tr>
      <tr>
        <td colspan="2">
          <textarea class="form-control" id="content" ></textarea>
        </td>
      </tr>
    </table>
    <button onclick="doChange()" class="btn btn-warning">변경하기</button>
    
  </div>
  <script>
    render();
    
    function render() {
      const bno = document.getElementById('bno').value = board.bno;
      const nickname = document.getElementById('nickname').value = board.nickname;
      const password = document.getElementById('password').value
      const title = document.getElementById('title').value = board.title;
      const content = document.getElementById('content').value = board.content;
    }
    function doChange() {
       //입력값 읽고 검증
        const title = document.getElementById('title').value;
        const password = document.getElementById('password').value;
        const content = document.getElementById('content').value;
        // const nickname = document.getElementById('nickname').value;
        // console.log(title,nickname,password,content);
        //검증
        if(title==="" || content==="" || password==="" ) {
          alert('제목, 비밀번호, 내용은 필수입력 칸입니다.');
          return;
        }
        
        //객체 찾아서 변경
        for(const b of boards) {
          if ( b.bno===bno) {
            if(b.password===password) {
              b.title = title;
              b.content=content;
              localStorage.setItem('boards',JSON.stringify(boards));
              location.href = `read.html?bno=${bno}`
            } else {
            alert('비밀번호가 틀립니다.');
            return;
            } 
          } 
        }  
    
        localStorage.setItem('boards',JSON.stringify(boards));
        location.href="index-1.html";
  
    }
  </script>
</body>
</html>